<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../WEB-INF/plantilla/layout-prod.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:daw="http://java.sun.com/jsf/composite/dawcomp"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="left">
        <h:form>
            <p:card style="height: available; width: available; margin-top: 10%; margin-bottom: 10%; padding-top: 0;">
                <h:graphicImage width="100%" name="#{prodCtrl.producto.imagen}" library="images"/>
            </p:card>
            <p:card style="height: available; width: available; margin-top: 3%; margin-bottom: 6%; padding-top: 0;">
                <center> <p:commandButton styleClass="ui-button-success" value="Volver a productos" icon="pi pi-chevron-left" action ="index"/></center>
            </p:card>
        </h:form>
    </ui:define>

    <ui:define name="content">

        <h:form>
            <h:head>
                <f:metadata>
                    <f:viewParam name ="id" required ="true"
                                 value ="#{prodCtrl.producto.id}"/>
                    <f:viewAction action = "#{prodCtrl.recupera()}"/>
                </f:metadata>
            </h:head>
            <p:card style="margin-right: 10%; margin-left: 10%;margin-top: 5%; margin-bottom: 5%;">
                <f:facet name="title">
                    <h1>
                        #{prodCtrl.producto.nombre}
                        <p:commandButton style="float: right" styleClass="ui-button-danger" value="Borrar producto" icon="pi pi-times" action ="#{prodCtrl.borrar()}"/> 
                        <p style="color: white; float: right"> he</p>
                        <p:commandButton style="float: right" styleClass="ui-button-success" value="Editar producto" icon="pi pi-pencil" action ="#{prodCtrl.edita()}"/> 
                        <p style="color: white; float: right"> he</p>
                        <p:commandButton style="float: right" value="Favorito" icon="pi pi-heart" action ="#{usuarioCtrl.addFav(prodCtrl.producto, request.remoteUser)}"/>
                    </h1>
                </f:facet>
                <f:facet name="subtitle">
                    <hr></hr>
                    <br>#{prodCtrl.producto.descripcion}</br>
                    <div style="margin-left: 1%">
                        <br><b>Distribuido por: </b>#{prodCtrl.producto.marca}</br>
                        <br><b>Estado: </b>#{prodCtrl.producto.estado}</br>
                        <br><b>Categoría: </b>#{prodCtrl.producto.categoria}</br>
                        <br><b>En: </b>#{prodCtrl.producto.ventAlq}<p style="color: white">separador</p>
                            <p:commandButton styleClass="ui-button-success" value="¡¡COMPRAR!!" icon="pi pi-shopping-cart" action ="index"/></br>
                    </div>           
                </f:facet>
                <f:facet name="footer">                    
                    <br> <p><i>Publicado por:</i> </p></br>

                    <h3>Precio: #{prodCtrl.producto.precio}€</h3>


                </f:facet> 
            </p:card>
            <c:if test="#{request.isUserInRole('USUARIOS')}">
                <br>   <center><h1>Agregar comentario</h1></center></br>
                <br>
                    <p:inputTextarea style="margin-left: 13%;width: 900px; margin-right: 5%" rows="5" value="#{prodCtrl.producto.comentario}"  ></p:inputTextarea>
                </br>
                <br> <center> <p:commandButton styleClass="ui-button-success" value="Confirmar" icon="pi pi-comment" action ="#{prodCtrl.addComent()}"/> </center></br>
                <br></br>
            </c:if>

            <c:if test="#{request.isUserInRole('ADMINISTRADORES')}">
                <br>   <center><h1>Agregar comentario</h1></center></br>
                <br>
                    #{coment.setId_usuario(usuarioCtrl.usuId(request.remoteUser))}
                    <p:inputTextarea style="margin-left: 13%;width: 900px; margin-right: 5%" rows="5" value="#{prodCtrl.producto.comentario}"  ></p:inputTextarea>
                </br>
                <br> <center> <p:commandButton styleClass="ui-button-success" value="Confirmar" icon="pi pi-comment" action ="#{prodCtrl.addComent()}"/> </center></br>
                <br></br>
            </c:if>

            <center><h1>Lista de comentarios</h1></center>
            <ui:repeat var="p" value="#{prodCtrl.producto.comentarios}">

                <p:card style="margin-right: 10%; margin-left: 10%;margin-top: 5%; margin-bottom: 5%;">
                    <f:facet name="subtitle">
                        #{p}
                    </f:facet>
                </p:card>

            </ui:repeat>
        </h:form>
    </ui:define>


</ui:composition>
